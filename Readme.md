# Product DB

## A. Scenario

We want you to build an API to handle Product data. The products should be stored and retrieved from a Postgres database.


## B. What you will be working on

In this lab, you will focus on connecting an application to a database by connecting the entities to the database tables and adding data to them.
We have supplied you with some guiding tests and a rest API for this exercise. Please add your own tests, but also use tools like Postman or swagger to test your API.

We want you to finish implementing the DB access features for an API using Spring-web which has the following endpoints.

* `GET` `/api/products` - list all products, including the group name for each product
* `GET` `/api/products/:id`  - get one specific product, this should also display the group name that the product belongs to.
* `POST` `/api/products` - add a new product, with all fields except id. Also, require a `productGroupId` value as a parameter. You can assume that the clients know an existing `productGroupId`
* `PUT` `/api/products/:id` - _replaces_ all the product information for the given id.
* `PATCH` `/api/products/:id` - updates the product information for the given id with the data supplied but keeps the data for any values that are _not_ supplied.
* `DELETE` `/api/products/:id` - delete the product with the given id
* `GET` `/api/products/?group=[groupname]`  - get all products for any `groupname`s specified
* `GET` `/api/productgroups` - Gets a list of all product groups.


## C. Setup

- IntelliJ
- Docker
  - PgAdmin
  - PgSql

## D. Lab instructions

There are tests to guide you, but they are failing at the moment.

First, we want you to make sure we manage the two Entities properly in the database.
Auto-generate the tables at first, but when you are happy with your entities and the resulting tables, switch the auto-generation off. After a few restarts, you'll figure out why...


* The `ProductGroup` entity holds groups of products such as Food, Beverages, and Toys.
  * The product group should have two fields
    * `id` is a unique, autogenerated, identifier
    * `name` - the name of the group. It's mandatory
* `Product` - contains all information about the products. It should have a relationship to the `ProductGroup` entity so that a product can belong to a product group
  * `id` is a unique, auto-generated, identifier
  * `name` - the name of the product such as Beer, Pizza, or Lego (mandatory)
  * `description` - the description of the product (optional)
  * `price` - a price, in decimal form, of the product (mandatory)
  * `productGroupId` - a foreign key to the product group to which the product belongs (mandatory)

- Start fixing the test for the ProductGroupRepository (you can `@disable` the other tests if you want to).
  - Add the necessary JPA annotations for the Entity
  - Add the configuration to connect to your database
    - use an in-memory DB for the tests first, you have some starting config...
    - Add the necessary JPA config to generate the schema
    - Check the logs to make sure you are creating the schema.
    - Seed the database with three product groups. They are your own choice, the instructors like `Food`, `Sports Gear` and `Toys` though, so we created tests for those, to set you off on a good path...
  - Create a new interface that extends the JPA `CrudRepository` to connect to the database and inject that into the ProductGroupRepository
    - Implement the database access code needed based on the lecture
- Then Implement the ProductRepository functionality. 
  - This does not have any tests, you'll probably want to add some.
  - Implement the JPA `CrudRepository` functionality behind the repo and make sure the `Product` Entity is managed as well.
- Once the tests run with an in-memory DB, it's time to hook it up to your real database
    - add the connection configuration for your PostgreSQL DB
    - make sure that you are initializing the schema and seeding the database correctly. 
    - For the real database, you should not drop and recreate each time. 
    - Have a look at the database seeding, make sure it does not create duplicates...


### Stretch goals

-  Add database migrations using Liquibase or Flyway and manage the schema & tables through that.

## E. Useful information

* Create an account at [ElephantSQL](https://www.elephantsql.com/) and create a free tier (Tiny Turtle) database instance.
* Add the server and connect to your *shared* instance with your fresh database.
  * Poke around and get a little bit familiar with the UI, remember you can right-click even though it is a website.
    * You can create tables with PgAdmin (installed on your computers) and then save the table and its data to a script, by choosing the Scripts -> Create Script feature.
    * These can be used in your application as `data.sql` and `schema.sql` for spring-data initialization
* We have supplied you with a very simple starting version of the API in the `ProductAPI.java`-file
    * You will have to complete the Object model and build the Repo yourselves
* We have supplied you with tests, but we encourage you to write your own, both unit tests and E2E tests.
    * You should also use Postman to test your API manually
* Notice that there is no bootstrapped data, therefore you need to add the `data.sql` script so you can fill the tables with data at startup. This is referred to as seeding the database.

---

Good luck and have fun!
